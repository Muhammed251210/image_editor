<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Fotoğraf Düzenleyici</title>
<style>
body { font-family: Arial,sans-serif; background:#f6f6f6; text-align:center; margin:0; }
#container { position: relative; display: inline-block; margin:30px 0; background:#fff; box-shadow:0 0 12px #ccc; max-width:100vw; }
#container img { display: block; width:100%; height:100%; object-fit:contain; }
#filteredContainer { position:absolute; top:0; left:0; height:100%; overflow:hidden; pointer-events:none; }
#filteredImg { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:contain; }
#handle { position:absolute; top:0; width:7px; height:100%; background:#29a1f1; border-radius:4px; cursor:ew-resize; z-index:2; transition:background .2s; }
#handle:hover { background:#1972ac; }
#lens { position:absolute; border:2px solid #29a1f1; border-radius:50%; width:150px; height:150px; overflow:hidden; display:none; z-index:3; pointer-events:none; background:rgba(255,255,255,0.05); }
#lensImg { position:absolute; top:0; left:0; object-fit:contain; }
#controls { margin-top:20px; display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
button,input[type=file] { padding:7px 14px; border:none; border-radius:5px; cursor:pointer; font-size:1em; }
button { background:#29a1f1; color:#fff; transition:background .2s; }
button:hover { background:#1972ac; }
.filter-group { display:flex; flex-wrap:wrap; justify-content:center; gap:24px; margin-bottom:16px; }
.filter-item { display:flex; flex-direction:column; align-items:center; }
label { margin-bottom:3px; font-weight:500; }
input[type=range] { width:120px; }
.presets { display:flex; gap:10px; justify-content:center; margin-bottom:16px; flex-wrap:wrap; }
.presets button { background:#555; color:#fff; }
.presets button:hover { background:#333; }
@media(max-width:700px){ .filter-group{flex-direction:column;align-items:center;} .presets{flex-direction:column;align-items:center;} }
</style>
</head>
<body>
<h2>Fotoğraf Düzenleyici</h2>

<div id="controls">
<input type="file" id="upload" accept="image/*">
<button id="modeBtn">Lens Modu</button>
<button id="reset">Sıfırla</button>
<button id="save">Kaydet</button>
</div>

<div class="presets">
<button data-preset="normal">Normal</button>
<button data-preset="bw">B/W</button>
<button data-preset="sepia">Sepya</button>
<button data-preset="highcontrast">Yüksek Kontrast</button>
<button data-preset="vivid">Canlı</button>
</div>

<div id="container" style="width:480px; height:300px;">
<img id="originalImg" src="https://dummyimage.com/480x300/cccccc/464646.png&text=Resim+yükle">
<div id="filteredContainer" style="width:50%;height:100%;">
<img id="filteredImg" src="https://dummyimage.com/480x300/cccccc/464646.png&text=Resim+yükle">
</div>
<div id="handle" style="left:50%;"></div>
<div id="lens">
<img id="lensImg" src="https://dummyimage.com/480x300/cccccc/464646.png&text=Resim+yükle">
</div>
</div>

<div class="filter-group">
<div class="filter-item"><label>Kontrast</label><input type="range" id="contrast" min="0" max="200" value="100"></div>
<div class="filter-item"><label>Parlaklık</label><input type="range" id="brightness" min="0" max="200" value="100"></div>
<div class="filter-item"><label>Doygunluk</label><input type="range" id="saturate" min="0" max="200" value="100"></div>
<div class="filter-item"><label>Renk</label><input type="range" id="hue" min="0" max="360" value="0"></div>
<div class="filter-item"><label>Sepya</label><input type="range" id="sepia" min="0" max="100" value="0"></div>
<div class="filter-item"><label>Bulanık</label><input type="range" id="blur" min="0" max="10" value="0" step="0.2"></div>
<div class="filter-item"><label>Vignette</label><input type="range" id="vignette" min="0" max="100" value="0"></div>
<div class="filter-item"><label>Sharpen</label><input type="range" id="sharpen" min="0" max="5" value="0" step="0.1"></div>
<div class="filter-item"><label>Gamma</label><input type="range" id="gamma" min="0.1" max="3" value="1" step="0.1"></div>
<div class="filter-item"><label>Invert</label><input type="range" id="invert" min="0" max="100" value="0"></div>
<div class="filter-item"><label>Grayscale</label><input type="range" id="grayscale" min="0" max="100" value="0"></div>
</div>

<script>
const filters = {
contrast: document.getElementById('contrast'),
brightness: document.getElementById('brightness'),
saturate: document.getElementById('saturate'),
hue: document.getElementById('hue'),
sepia: document.getElementById('sepia'),
blur: document.getElementById('blur'),
vignette: document.getElementById('vignette'),
sharpen: document.getElementById('sharpen'),
gamma: document.getElementById('gamma'),
invert: document.getElementById('invert'),
grayscale: document.getElementById('grayscale')
};
const defaultValues = {contrast:100,brightness:100,saturate:100,hue:0,sepia:0,blur:0,vignette:0,sharpen:0,gamma:1,invert:0,grayscale:0};

const upload=document.getElementById('upload');
const container=document.getElementById('container');
const originalImg=document.getElementById('originalImg');
const filteredImg=document.getElementById('filteredImg');
const filteredContainer=document.getElementById('filteredContainer');
const handle=document.getElementById('handle');
const lens=document.getElementById('lens');
const lensImg=document.getElementById('lensImg');
const modeBtn=document.getElementById('modeBtn');

let lensMode=false;

function applyFilters(){
    let filterStr = 
    `contrast(${filters.contrast.value}%) 
     brightness(${filters.brightness.value}%) 
     saturate(${filters.saturate.value}%) 
     hue-rotate(${filters.hue.value}deg) 
     sepia(${filters.sepia.value}%) 
     blur(${filters.blur.value}px) 
     invert(${filters.invert.value}%) 
     grayscale(${filters.grayscale.value}%)`;
     
    filteredImg.style.filter = filterStr;
    lensImg.style.filter = filterStr;
}

Object.values(filters).forEach(f=>f.addEventListener('input',applyFilters));

let isDragging=false;
function moveHandle(clientX){
    const rect=container.getBoundingClientRect();
    const offsetX=Math.min(Math.max(clientX-rect.left,0),rect.width);
    handle.style.left=`${offsetX}px`;
    filteredContainer.style.width=`${offsetX}px`;
}
handle.addEventListener('mousedown',()=>isDragging=true);
document.addEventListener('mouseup',()=>isDragging=false);
document.addEventListener('mousemove',e=>{if(isDragging) moveHandle(e.clientX);});
handle.addEventListener('touchstart',e=>{isDragging=true;e.preventDefault();});
window.addEventListener('touchend',()=>isDragging=false);
window.addEventListener('touchmove',e=>{if(isDragging) moveHandle(e.touches[0].clientX);});

function updateLensSize(){
    lensImg.style.width=originalImg.offsetWidth+'px';
    lensImg.style.height=originalImg.offsetHeight+'px';
}

upload.addEventListener('change',e=>{
    const file=e.target.files[0];
    if(!file) return;
    const url=URL.createObjectURL(file);
    originalImg.src=url;
    filteredImg.src=url;
    lensImg.src=url;
    originalImg.onload=()=>{
        filteredImg.style.width=originalImg.offsetWidth+'px';
        filteredImg.style.height=originalImg.offsetHeight+'px';
        updateLensSize();
        applyFilters();
        handle.style.left='50%';
        filteredContainer.style.width='50%';
    };
});

document.getElementById('reset').addEventListener('click',()=>{
    Object.keys(filters).forEach(k=>filters[k].value=defaultValues[k]);
    applyFilters();
    handle.style.left='50%';
    filteredContainer.style.width='50%';
    updateLensSize();
});

modeBtn.addEventListener('click',()=>{
    lensMode=!lensMode;
    if(lensMode){
        lens.style.display='block';
        handle.style.display='none';
        filteredContainer.style.opacity='0';
        modeBtn.textContent='Çubuk Modu';
        updateLensSize();
    } else {
        lens.style.display='none';
        handle.style.display='block';
        filteredContainer.style.opacity='1';
        filteredContainer.style.width='50%';
        modeBtn.textContent='Lens Modu';
    }
});

function moveLens(clientX,clientY){
    const rect=container.getBoundingClientRect();
    const lensSize=lens.offsetWidth;
    let x=clientX-rect.left-lensSize/2;
    let y=clientY-rect.top-lensSize/2;
    x=Math.max(0,Math.min(x,rect.width-lensSize));
    y=Math.max(0,Math.min(y,rect.height-lensSize));
    lens.style.left=`${x}px`;
    lens.style.top=`${y}px`;
    lensImg.style.left=`${-x}px`;
    lensImg.style.top=`${-y}px`;
    lensImg.style.width=originalImg.offsetWidth+'px';
    lensImg.style.height=originalImg.offsetHeight+'px';
}

container.addEventListener('mousemove',e=>{if(lensMode) moveLens(e.clientX,e.clientY);});
container.addEventListener('touchmove',e=>{if(lensMode&&e.touches.length>0){e.preventDefault(); moveLens(e.touches[0].clientX,e.touches[0].clientY);}});

document.querySelectorAll('.presets button').forEach(btn=>{
    btn.addEventListener('click',()=>{
        switch(btn.dataset.preset){
            case 'normal': Object.keys(filters).forEach(k=>filters[k].value=defaultValues[k]); break;
            case 'bw': filters.grayscale.value=100; filters.sepia.value=0; break;
            case 'sepia': filters.sepia.value=100; filters.grayscale.value=0; break;
            case 'highcontrast': filters.contrast.value=150; break;
            case 'vivid': filters.saturate.value=150; filters.brightness.value=120; break;
        }
        applyFilters();
    });
});

document.getElementById('save').addEventListener('click',()=>{
    if(!originalImg.src||originalImg.src.includes('dummyimage')) return;
    const canvas=document.createElement('canvas');
    const ctx=canvas.getContext('2d');
    canvas.width=originalImg.naturalWidth;
    canvas.height=originalImg.naturalHeight;
    
    ctx.filter = 
    `contrast(${filters.contrast.value}%) 
     brightness(${filters.brightness.value}%) 
     saturate(${filters.saturate.value}%) 
     hue-rotate(${filters.hue.value}deg) 
     sepia(${filters.sepia.value}%) 
     blur(${filters.blur.value}px) 
     invert(${filters.invert.value}%) 
     grayscale(${filters.grayscale.value}%)`;
     
    ctx.drawImage(originalImg,0,0,canvas.width,canvas.height);
    
    // Gamma
    if(filters.gamma.value!=1){
        const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
        const data=imgData.data;
        const gamma=1/filters.gamma.value;
        for(let i=0;i<data.length;i+=4){
            data[i]=255*Math.pow(data[i]/255,gamma);
            data[i+1]=255*Math.pow(data[i+1]/255,gamma);
            data[i+2]=255*Math.pow(data[i+2]/255,gamma);
        }
        ctx.putImageData(imgData,0,0);
    }
    
    // Vignette
    if(filters.vignette.value>0){
        const grad=ctx.createRadialGradient(canvas.width/2,canvas.height/2,0,canvas.width/2,canvas.height/2,Math.max(canvas.width,canvas.height)/1.2);
        grad.addColorStop(0,'rgba(0,0,0,0)');
        grad.addColorStop(1,`rgba(0,0,0,${filters.vignette.value/100})`);
        ctx.fillStyle=grad;
        ctx.fillRect(0,0,canvas.width,canvas.height);
    }

    // Sharpen (basit kernel)
    if(filters.sharpen.value>0){
        const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
        const data=imgData.data;
        const factor=filters.sharpen.value;
        for(let i=4;i<data.length-4;i+=4){
            data[i]=Math.min(255,Math.max(0,data[i]+factor*(data[i]-data[i-4])));
            data[i+1]=Math.min(255,Math.max(0,data[i+1]+factor*(data[i+1]-data[i-3])));
            data[i+2]=Math.min(255,Math.max(0,data[i+2]+factor*(data[i+2]-data[i-2])));
        }
        ctx.putImageData(imgData,0,0);
    }
    
    const dataURL=canvas.toDataURL("image/jpeg",0.9);
    const a=document.createElement('a');
    a.href=dataURL;
    a.download='duzenlenmis_resim.jpg';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});

applyFilters();
</script>
</body>
</html>
