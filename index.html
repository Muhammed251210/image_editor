<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tek Resim Düzenleyici - Mükemmel Hizalama ve Filtreleme</title>
<style>
/* --- Genel Stil --- */
body { 
    margin:0; 
    background:#111; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    color:white; 
    padding-bottom:40px; 
    font-family:sans-serif; 
}

/* --- Konteyner (Karşılaştırma Alanı) --- */
#container { 
    position:relative; 
    width:90vw; 
    max-width:500px; 
    height: auto; 
    overflow:hidden; 
    border-radius:16px; 
    margin-top:20px; 
    background:#222; 
}

/* Tüm img öğeleri */
img { 
    width:100%; 
    display:block; 
    pointer-events:none; 
    /* MAVİ EKRAN HATASINI ÇÖZEN DÜZELTME */
    opacity: 0; 
    transition: opacity 0.5s; 
}

/* --- YENİ: Filtresiz Resim (ARKA PLAN) --- */
#original-img {
    position: relative; 
    z-index: 1;
}

/* --- SOL TARAF (Filtreli Hali - ÖN PLAN) --- */
#filtered-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 50%; /* Sürgü ile kontrol edilir */
    height: 100%;
    overflow: hidden;
    z-index: 5;
}

/* Filtreli resim kopyası: Mükemmel kaymasız hizalama için kritik */
#filtered-img {
    position: absolute; 
    top: 0;
    left: 0; 
    width: 100%; /* Kapsayıcının (container) genişliği kadar yer kaplar */
    height: 100%;
}

/* --- Sürgü Kolu --- */
#handle { 
    position:absolute; 
    top:0; 
    left:50%; 
    width:6px; 
    height:100%; 
    background:white; 
    cursor:ew-resize; 
    border-radius:3px; 
    z-index:10; 
    transform: translateX(-50%); 
    opacity: 1; /* Daima görünür */
    display: block; 
}

/* --- Vinyet ve Kontroller Diğer Stiller --- */
.vignette {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 15;
    mix-blend-mode: multiply; 
}
#upload { margin-top:10px; }
#controls { 
    width:90vw; 
    max-width:500px; 
    margin-top:20px; 
    display:flex; 
    flex-direction:column; 
    gap:10px; 
}
#controls label { font-size:14px; }
#controls input[type=range] { width:100%; }
#reset, #save { 
    margin-top:10px; 
    padding:8px 12px; 
    border-radius:6px; 
    cursor:pointer; 
    border: none;
    font-weight: bold;
}
#reset { background:#555; color:white; }
#save { background:#28a745; color:white; }
</style>
</head>
<body>

<input type="file" id="upload" accept="image/*" />

<div id="container">
    <img id="original-img" src="data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 500 300'%3E%3Crect width='500' height='300' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='%23ccc'%3EResim Yükle%3C/text%3E%3C/svg%3E" alt="Filtresiz Resim" />
    
    <div id="handle"></div>
</div>

<div id="controls">
    <label>Kontrast <span id="cVal">100</span>%</label>
    <input type="range" id="contrast" min="50" max="200" value="100">

    <label>Parlaklık <span id="bVal">100</span>%</label>
    <input type="range" id="brightness" min="50" max="200" value="100">
    
    <label>Doygunluk <span id="sVal">100</span>%</label>
    <input type="range" id="saturate" min="0" max="300" value="100">

    <label>Hue Rotate <span id="hVal">0</span>°</label>
    <input type="range" id="hue" min="0" max="360" value="0">

    <label>Sepia <span id="sepVal">0</span>%</label>
    <input type="range" id="sepia" min="0" max="100" value="0">

    <label>Blur <span id="blurVal">0</span>px</label>
    <input type="range" id="blur" min="0" max="10" value="0">

    <label>Opacity <span id="opVal">100</span>%</label>
    <input type="range" id="opacity" min="10" max="100" value="100">

    <label>Vignette <span id="vigVal">0</span>%</label>
    <input type="range" id="vignette" min="0" max="80" value="0">

    <label>Gamma <span id="gammaVal">1</span></label>
    <input type="range" id="gamma" min="0.1" max="3" step="0.1" value="1">

    <button id="reset">Sıfırla</button>
    <button id="save">Kaydet</button>
</div>

<script>
const upload = document.getElementById("upload");
const originalImg = document.getElementById("original-img"); 
const handle = document.getElementById("handle");
const container = document.getElementById("container");
const saveBtn = document.getElementById("save");

// --- Gerekli Elementleri Oluştur ve DOM'a Ekle ---
const filteredContainer = document.createElement('div');
filteredContainer.id = 'filtered-container';
const filteredImg = document.createElement('img');
filteredImg.id = 'filtered-img';
const vignetteLayer = document.createElement('div');
vignetteLayer.className = 'vignette';

filteredContainer.appendChild(filteredImg);
filteredContainer.appendChild(vignetteLayer);
container.insertBefore(filteredContainer, handle); 
// ---------------------------------------------------

const filters = {
    contrast: document.getElementById("contrast"), brightness: document.getElementById("brightness"), saturate: document.getElementById("saturate"), 
    hue: document.getElementById("hue"), sepia: document.getElementById("sepia"), blur: document.getElementById("blur"), 
    opacity: document.getElementById("opacity"), vignette: document.getElementById("vignette"), gamma: document.getElementById("gamma")
};
const vals = {
    cVal: document.getElementById("cVal"), bVal: document.getElementById("bVal"), sVal: document.getElementById("sVal"), 
    hVal: document.getElementById("hVal"), sepVal: document.getElementById("sepVal"), blurVal: document.getElementById("blurVal"), 
    opVal: document.getElementById("opVal"), vigVal: document.getElementById("vigVal"), gammaVal: document.getElementById("gammaVal")
};
const defaultValues = { contrast: 100, brightness: 100, saturate: 100, hue: 0, sepia: 0, blur: 0, opacity: 100, vignette: 0, gamma: 1 };


function applyFilters() {
    const filterStr = `contrast(${filters.contrast.value}%) brightness(${filters.brightness.value}%) saturate(${filters.saturate.value}%) hue-rotate(${filters.hue.value}deg) sepia(${filters.sepia.value}%) blur(${filters.blur.value}px) opacity(${filters.opacity.value}%)`;
    
    filteredImg.style.filter = filterStr;

    const vigVal = filters.vignette.value;
    const shadowSize = vigVal * 1.5; 
    const opacityVal = vigVal / 100 * 0.8; 
    vignetteLayer.style.boxShadow = `0 0 ${shadowSize}px rgba(0, 0, 0, ${opacityVal}) inset`;

    vals.cVal.textContent = filters.contrast.value; 
    vals.bVal.textContent = filters.brightness.value;
    vals.sVal.textContent = filters.saturate.value;
    vals.hVal.textContent = filters.hue.value;
    vals.sepVal.textContent = filters.sepia.value;
    vals.blurVal.textContent = filters.blur.value;
    vals.opVal.textContent = filters.opacity.value;
    vals.vigVal.textContent = filters.vignette.value;
    vals.gammaVal.textContent = filters.gamma.value;
}

Object.values(filters).forEach(el => el.addEventListener("input", applyFilters));


// --- Sürgü Hareketi İşlevleri ---
let isDragging = false;
function moveHandle(clientX) {
    const rect = container.getBoundingClientRect();
    const offsetX = Math.min(Math.max(clientX - rect.left, 0), rect.width);
    
    handle.style.left = offsetX + 'px';
    filteredContainer.style.width = offsetX + 'px';
}
handle.addEventListener('mousedown', () => isDragging = true);
document.addEventListener('mouseup', () => isDragging = false);
document.addEventListener('mousemove', e => { if(isDragging) moveHandle(e.clientX); });
handle.addEventListener('touchstart', e => { isDragging = true; e.preventDefault(); });
window.addEventListener('touchend', () => isDragging = false);
window.addEventListener('touchmove', e => { if(isDragging) moveHandle(e.touches[0].clientX); });


// --- Resim Yükleme İşlevi ---
upload.addEventListener('change', e => {
    const file = e.target.files[0];
    if(!file) return;
    const url = URL.createObjectURL(file);
    
    originalImg.src = url;
    filteredImg.src = url; 

    originalImg.onload = () => {
        // MAVİ EKRAN ÇÖZÜMÜ: Resimler yüklendikten sonra görünür hale gelir.
        originalImg.style.opacity = 1;
        filteredImg.style.opacity = 1; 

        applyFilters();
        handle.style.left = '50%';
        filteredContainer.style.width = '50%';
    };
});


// --- Sıfırlama ve Kaydetme İşlevleri (Canvas) ---
document.getElementById('reset').addEventListener('click', () => {
    Object.keys(filters).forEach(key => { filters[key].value = defaultValues[key]; });
    applyFilters();
    handle.style.left = '50%';
    filteredContainer.style.width = '50%';
});

saveBtn.addEventListener('click', () => {
    if (!originalImg.src || originalImg.src.startsWith('data:image/svg')) { alert("Lütfen önce bir resim yükleyin."); return; }
    
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = originalImg.naturalWidth;
    canvas.height = originalImg.naturalHeight;

    ctx.drawImage(originalImg, 0, 0, canvas.width, canvas.height);
    
    const filterStr = `contrast(${filters.contrast.value}%) brightness(${filters.brightness.value}%) saturate(${filters.saturate.value}%) hue-rotate(${filters.hue.value}deg) sepia(${filters.sepia.value}%) blur(${filters.blur.value}px) opacity(${filters.opacity.value}%)`;
    ctx.filter = filterStr;
    ctx.drawImage(originalImg, 0, 0, canvas.width, canvas.height);

    if (filters.vignette.value > 0) {
        const vigVal = filters.vignette.value / 100 * 0.8; 
        const gradient = ctx.createRadialGradient(
            canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, Math.max(canvas.width, canvas.height) / 2
        );
        gradient.addColorStop(0, `rgba(0, 0, 0, 0)`);
        gradient.addColorStop(0.5, `rgba(0, 0, 0, 0)`);
        gradient.addColorStop(1, `rgba(0, 0, 0, ${vigVal})`);
        ctx.fillStyle = gradient;
        ctx.globalCompositeOperation = 'source-over'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
    
    const dataURL = canvas.toDataURL("image/jpeg", 0.9); 
    const a = document.createElement('a');
    a.href = dataURL;
    a.download = 'duzenlenmis_resim.jpg';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});

applyFilters();
</script>
</body>
</html>
