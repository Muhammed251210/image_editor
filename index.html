<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ä°ki Modlu Resim DÃ¼zenleyici ve AI OluÅŸturucu</title>
<style>
/* CSS KISMI DEÄÄ°ÅMEDÄ°ÄÄ° Ä°Ã‡Ä°N BURADA YER ALMIYOR. 
   LÃœTFEN Ã–NCEKÄ° MESAJLARDAKÄ° TÃœM <style> Ä°Ã‡ERÄ°ÄÄ°NÄ° KULLANIN. */

body { 
    margin:0; 
    background:#111; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    color:white; 
    padding-bottom:40px; 
    font-family:sans-serif; 
}
/* ... diÄŸer CSS kodlarÄ± ... */
</style>
</head>
<body>

<h2>ğŸ–¼ï¸ Resim DÃ¼zenleyici (YÃ¼kle & Filtrele)</h2>

<input type="file" id="upload" accept="image/*" />

<div id="container">
    <img id="original-img" src="data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 500 300'%3E%3Crect width='500' height='300' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='%23ccc'%3EYÃ¼klemek Ä°Ã§in TÄ±klayÄ±n%3C/text%3E%3C/svg%3E" alt="Filtresiz Resim" />
    
    <div id="handle"></div>
</div>

<div id="controls">
    <label>Kontrast <span id="cVal">100</span>%</label>
    <input type="range" id="contrast" min="50" max="200" value="100">

    <label>ParlaklÄ±k <span id="bVal">100</span>%</label>
    <input type="range" id="brightness" min="50" max="200" value="100">
    
    <label>Doygunluk <span id="sVal">100</span>%</label>
    <input type="range" id="saturate" min="0" max="300" value="100">

    <label>Hue Rotate <span id="hVal">0</span>Â°</label>
    <input type="range" id="hue" min="0" max="360" value="0">

    <label>Sepia <span id="sepVal">0</span>%</label>
    <input type="range" id="sepia" min="0" max="100" value="0">

    <label>Blur <span id="blurVal">0</span>px</label>
    <input type="range" id="blur" min="0" max="10" value="0">

    <label>Opacity <span id="opVal">10</span>%</label>
    <input type="range" id="opacity" min="10" max="100" value="10">

    <label>Vignette <span id="vigVal">0</span>%</label>
    <input type="range" id="vignette" min="0" max="80" value="0">

    <label>Gamma <span id="gammaVal">1</span></label>
    <input type="range" id="gamma" min="0.1" max="3" step="0.1" value="1">

    <button id="reset">SÄ±fÄ±rla</button>
    <button id="save">DÃ¼zenlenmiÅŸ Resmi Kaydet</button>
</div>

<hr style="width:90vw; max-width:500px; margin:40px 0; border:1px solid #333;" />


<h2>ğŸ¤– AI GÃ¶rÃ¼ntÃ¼ OluÅŸturma</h2>

<div id="chatbot-container">
    <div id="chat-messages">
        <p style="color:#88ff88;">**AI**: Merhaba! Yeni bir resim oluÅŸturmak iÃ§in komutlarÄ±nÄ±zÄ± yazÄ±n (Ã–rn: 'uzayda bir kedi Ã§iz', 'siberpunk ÅŸehir'). OluÅŸturulan resim sol tarafta gÃ¶rÃ¼ntÃ¼lenecektir.</p>
    </div>
    <input type="text" id="chat-input" placeholder="OluÅŸturmak istediÄŸiniz resmi yazÄ±n..." >
    <button id="chat-send">OluÅŸtur</button>
    <button id="ai-save" style="background:#5bc0de; color:white; margin-top:10px; padding:8px 12px; border-radius:6px; cursor:pointer; border:none; font-weight: bold;">AI Resmini Kaydet</button>
</div>


<script>
// --- ELEMENT TANIMLAMALARI ---
const upload = document.getElementById("upload");
const originalImg = document.getElementById("original-img"); 
const handle = document.getElementById("handle");
const container = document.getElementById("container");
const saveBtn = document.getElementById("save");
const aiSaveBtn = document.getElementById("ai-save"); // Yeni Kaydet butonu

// --- Dinamik Element OluÅŸturma (AynÄ± KaldÄ±) ---
const filteredContainer = document.createElement('div');
filteredContainer.id = 'filtered-container';
const filteredImg = document.createElement('img');
filteredImg.id = 'filtered-img';
const vignetteLayer = document.createElement('div');
vignetteLayer.className = 'vignette';

filteredContainer.appendChild(filteredImg);
filteredContainer.appendChild(vignetteLayer);
container.insertBefore(filteredContainer, handle); 
// ---------------------------------------------------

const filters = {
    contrast: document.getElementById("contrast"), brightness: document.getElementById("brightness"), saturate: document.getElementById("saturate"), 
    hue: document.getElementById("hue"), sepia: document.getElementById("sepia"), blur: document.getElementById("blur"), 
    opacity: document.getElementById("opacity"), vignette: document.getElementById("vignette"), gamma: document.getElementById("gamma")
};
const vals = {
    cVal: document.getElementById("cVal"), bVal: document.getElementById("bVal"), sVal: document.getElementById("sVal"), 
    hVal: document.getElementById("hVal"), sepVal: document.getElementById("sepVal"), blurVal: document.getElementById("blurVal"), 
    opVal: document.getElementById("opVal"), vigVal: document.getElementById("vigVal"), gammaVal: document.getElementById("gammaVal")
};
const defaultValues = { contrast: 100, brightness: 100, saturate: 100, hue: 0, sepia: 0, blur: 0, opacity: 10, vignette: 0, gamma: 1 };


// --- FÄ°LTRELEME VE SÃœRGÃœ Ä°ÅLEVLERÄ° (AynÄ± KaldÄ±) ---

function applyFilters() {
    // ... Filtreleme kodu aynÄ± kaldÄ± ...
    const filterStr = `contrast(${filters.contrast.value}%) brightness(${filters.brightness.value}%) saturate(${filters.saturate.value}%) hue-rotate(${filters.hue.value}deg) sepia(${filters.sepia.value}%) blur(${filters.blur.value}px) opacity(${filters.opacity.value}%)`;
    filteredImg.style.filter = filterStr;

    const vigVal = filters.vignette.value;
    const shadowSize = vigVal * 1.5; 
    const opacityVal = vigVal / 100 * 0.8; 
    vignetteLayer.style.boxShadow = `0 0 ${shadowSize}px rgba(0, 0, 0, ${opacityVal}) inset`;

    vals.cVal.textContent = filters.contrast.value; 
    vals.bVal.textContent = filters.brightness.value;
    vals.sVal.textContent = filters.saturate.value;
    vals.hVal.textContent = filters.hue.value;
    vals.sepVal.textContent = filters.sepia.value;
    vals.blurVal.textContent = filters.blur.value;
    vals.opVal.textContent = filters.opacity.value;
    vals.vigVal.textContent = filters.vignette.value;
    vals.gammaVal.textContent = filters.gamma.value;
}

Object.values(filters).forEach(el => el.addEventListener("input", applyFilters));

let isDragging = false;
function moveHandle(clientX) {
    // ... SÃ¼rgÃ¼ hareket kodu aynÄ± kaldÄ± ...
    const rect = container.getBoundingClientRect();
    const offsetX = Math.min(Math.max(clientX - rect.left, 0), rect.width);
    
    handle.style.left = offsetX + 'px';
    filteredContainer.style.width = offsetX + 'px';
}
handle.addEventListener('mousedown', () => isDragging = true);
document.addEventListener('mouseup', () => isDragging = false);
document.addEventListener('mousemove', e => { if(isDragging) moveHandle(e.clientX); });
handle.addEventListener('touchstart', e => { isDragging = true; e.preventDefault(); });
window.addEventListener('touchend', () => isDragging = false);
window.addEventListener('touchmove', e => { if(isDragging) moveHandle(e.touches[0].clientX); });


// --- YÃœKLEME, SIFIRLAMA VE KAYDETME Ä°ÅLEVLERÄ° (AynÄ± KaldÄ±) ---

upload.addEventListener('change', e => {
    // ... Resim yÃ¼kleme kodu aynÄ± kaldÄ± ...
    const file = e.target.files[0];
    if(!file) return;
    const url = URL.createObjectURL(file);
    
    originalImg.src = url;
    filteredImg.src = url; 

    originalImg.onload = () => {
        originalImg.style.opacity = 1;
        filteredImg.style.opacity = 1; 
        applyFilters();
        handle.style.left = '50%';
        filteredContainer.style.width = '50%';
        appendMessage("AI", "Resim yÃ¼klendi. Filtreleri uygulayabilirsiniz.", '#88ff88');
    };
});

document.getElementById('reset').addEventListener('click', () => {
    // ... Filtre sÄ±fÄ±rlama kodu aynÄ± kaldÄ± ...
    Object.keys(filters).forEach(key => { filters[key].value = defaultValues[key]; });
    applyFilters();
    handle.style.left = '50%';
    filteredContainer.style.width = '50%';
    appendMessage("AI", "Filtreler sÄ±fÄ±rlandÄ±.", '#88ff88');
});

saveBtn.addEventListener('click', () => {
    // ... DÃ¼zenlenmiÅŸ resmi kaydetme kodu (Canvas ile) aynÄ± kaldÄ± ...
    if (!originalImg.src || originalImg.src.startsWith('data:image/svg')) { alert("LÃ¼tfen Ã¶nce bir resim yÃ¼kleyin."); return; }
    
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = originalImg.naturalWidth;
    canvas.height = originalImg.naturalHeight;

    ctx.drawImage(originalImg, 0, 0, canvas.width, canvas.height); 
    
    const filterStr = `contrast(${filters.contrast.value}%) brightness(${filters.brightness.value}%) saturate(${filters.saturate.value}%) hue-rotate(${filters.hue.value}deg) sepia(${filters.sepia.value}%) blur(${filters.blur.value}px) opacity(${filters.opacity.value}%)`;
    ctx.filter = filterStr; 
    ctx.drawImage(originalImg, 0, 0, canvas.width, canvas.height); 
    
    // Vignette uygulama (aynÄ± kaldÄ±)
    if (filters.vignette.value > 0) {
        // ...
    }
    
    const dataURL = canvas.toDataURL("image/jpeg", 0.9); 
    const a = document.createElement('a');
    a.href = dataURL;
    a.download = 'duzenlenmis_resim.jpg';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    appendMessage("AI", "DÃ¼zenlenmiÅŸ resim kaydedildi.", '#88ff88');
});


// --- YENÄ° AI OLUÅTURULAN RESMÄ° KAYDETME Ä°ÅLEVÄ° ---

aiSaveBtn.addEventListener('click', () => {
    if (!filteredImg.src || filteredImg.src.startsWith('data:image/svg') || filteredImg.style.filter !== '') { 
        alert("LÃ¼tfen Ã¶nce bir AI resmi oluÅŸturun veya filtreleri sÄ±fÄ±rlayÄ±n."); 
        return; 
    }
    
    const dataURL = filteredImg.src; 
    if (dataURL.startsWith('data:image')) {
        const a = document.createElement('a');
        a.href = dataURL;
        a.download = 'ai_olusturulan_resim.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        appendMessage("AI", "OluÅŸturulan AI resmi kaydedildi.", '#88ff88');
    }
});


// ---------------------------------------------------
// --- CHATBOT VE KOMUT Ä°ÅLEME (AI'ya OdaklandÄ±) ---
// ---------------------------------------------------

const chatInput = document.getElementById("chat-input");
const chatSend = document.getElementById("chat-send");
const chatMessages = document.getElementById("chat-messages");

function appendMessage(sender, message, color) {
    const p = document.createElement('p');
    p.innerHTML = `<strong style="color:${color}">${sender}</strong>: ${message}`;
    chatMessages.appendChild(p);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// AI KomutlarÄ±nÄ± Ä°ÅŸleme Fonksiyonu (Filtre komutlarÄ± Ã§Ä±karÄ±ldÄ±)
function processCommand(command) {
    // Sadece AI komutlarÄ±na odaklanÄ±yoruz
    return callWorkerAI(command);
}

// ---------------------------------------------------
// --- CLOUDFLARE WORKERS AI BAÄLANTISI (AynÄ± KaldÄ±) ---
// ---------------------------------------------------

function callWorkerAI(command) {
    // Worker URL'niz
    const workerUrl = 'https://free-image-generation-api.muhammed251210.workers.dev/'; 

    appendMessage("AI", "ğŸ”„ Komutunuz Cloudflare Worker'a gÃ¶nderiliyor... LÃ¼tfen bekleyin.", '#FFFF00');
    
    fetch(workerUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
            prompt: command 
        }),
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(errorData => { 
                throw new Error(errorData.error || `HTTP Hata Kodu: ${response.status}`); 
            });
        }
        return response.json();
    })
    .then(data => {
        if (data.success && data.newImage) {
            // AI resmini filteredImg'e atÄ±yoruz.
            filteredImg.src = data.newImage; 
            
            appendMessage("AI", `âœ… AI Resmi oluÅŸturuldu: "${command}"`, '#88ff88');

            filteredImg.onload = () => {
                filteredImg.style.opacity = 1; 
                // Yeni resim yÃ¼klendiÄŸinde filtreleri sÄ±fÄ±rla/tekrar uygula
                applyFilters(); 
            };

        } else {
            appendMessage("AI", `âŒ Hata: AI yanÄ±tÄ± baÅŸarÄ±sÄ±z oldu. Detay: ${data.error || 'Bilinmeyen Hata'}`, '#FF5555');
        }
    })
    .catch(error => {
        appendMessage("AI", `âŒ BaÄŸlantÄ± HatasÄ±: ${error.message}.`, '#FF5555');
        console.error('Fetch Error:', error);
    });

    return `AI komutu ('${command}') Workers AI tarafÄ±ndan iÅŸleniyor. LÃ¼tfen sonucu bekleyin.`;
}


chatSend.addEventListener('click', () => {
    const command = chatInput.value.trim();
    if (command) {
        appendMessage("Siz", command, 'white');
        const response = processCommand(command);
        if (response) {
            appendMessage("AI", response, '#88ff88');
        }
        chatInput.value = '';
    }
});

// Enter tuÅŸu ile gÃ¶nderme (AynÄ± KaldÄ±)
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault(); 
        chatSend.click();
    }
});

applyFilters();
</script>
</body>
</html>
